jQuery(document).ready(function(t){t(".wp-switch-editor.switch-html").attr("disabled",!1),t(".wp-switch-editor.switch-ace").attr("disabled",!1);t("#content").AceEditor({onInit:function(){var e=this,i=t('<button id="content-ace" type="button" class="wp-switch-editor switch-ace">HTML</button>');i.appendTo(".wp-editor-tabs"),i.click(function(){return e.loaded||e.loadAce(),!1}),t("#content-html, #content-tmce").on("click",function(i){var n=t(i.currentTarget).attr("id").split("-")[1];if(e.loaded){switch(n){case"tmce":e.$container.find(".mce-container").show(),t(".wp-switch-editor.switch-html").attr("disabled",!1),t(".wp-switch-editor.switch-ace").attr("disabled",!1);break;case"html":e.$elem.show(),t("#ed_toolbar").show()}e.synchronize.apply(e),e.destroy(i)}else switch(n){case"tmce":t(".wp-switch-editor.switch-ace").attr("disabled",!1);break;case"html":t(".wp-switch-editor.switch-ace").attr("disabled",!0)}})},onLoaded:function(){var e=this;this.$elem.hide(),this.$container.find(".mce-container").hide(),t("#post-status-info").hide(),t("#wp-content-wrap").removeClass("html-active tmce-active").addClass("ace-active");var i=t('<div class="ace-options-toolbar">'),n=t('<input type="checkbox" id="ace-word-wrap" checked="checked" />'),o=t("<label> Word Wrap</label>");o.prepend(n),i.append(o),i.css({"float":"left","margin-left":"0.5em","padding-top":"0.3em"}),n.change(function(){e.reloadAce({wrapMode:this.checked})}),t("#wp-content-editor-tools #wp-content-media-buttons").after(i),t(".wp-switch-editor.switch-html").attr("disabled",!0),this.editor.focus()},onDestroy:function(e){var i=t(e.currentTarget).attr("id").split("-")[1];switch(setUserSetting("editor",i),t(".ace-options-toolbar").remove(),this.$container.resizable("destroy"),t("#post-status-info").show(),t("#wp-content-wrap").addClass(i+"-active").removeClass("ace-active"),i){case"tmce":this.$container.css({width:"auto",height:"auto","min-height":"auto","min-width":"auto"});break;case"html":}}})}),function(t){var e=function(e){t.extend(this,e),this.$elem=this.element,this.element=this.$elem.attr("id"),this.$container=this.container?t(this.container):this.$elem.parent(),this.contWd=this.$container.width(),this.loaded=!1,this.tinymce=!!window.tinymce,this.onInit&&this.onInit.call(this)};e.prototype={loadAce:function(){if(this.loaded)return!1;this.height=this.$container.height(),this.insertEditor(),this.editor=ace.edit(this.aceId),this.$editor=t("#"+this.aceId),this.setEditorProps(),this.setEditorContent(),this.setEditorStyle(),this.editor.resize(!0),this.loaded=!0,this.onLoaded&&this.onLoaded.call(this)},reloadAce:function(t){var e=this.editor.getValue();this.editor.destroy(),this.editor=ace.edit(this.aceId),this.setEditorProps(t),this.editor.getSession().setValue(e),this.setEditorStyle(),this.editor.resize(!0)},insertEditor:function(){t('<div id="'+this.aceId+'"></div>').insertAfter(this.$elem)},setEditorProps:function(e){var i="14px",n="ace/theme/sublime";try{ace_font_size&&ace_editor_theme&&(i=ace_font_size,n=ace_editor_theme)}catch(o){}this.editor.$blockScrolling=1/0;var s=require("ace/lib/dom");this.editor.commands.addCommands([{name:"toggleFullscreen",bindKey:{win:"F11",mac:"F11"},exec:function(e){var i=s.toggleCssClass(document.body,"fullScreen");s.setCssClass(e.container,"fullScreen",i);var n,o,r,a,d,c;i?(n=t("#adminmenuwrap"),o=t("#wpadminbar"),r=n.width(),a=o.height(),d=t(window).width()-r,c=t(window).height()-a,"none"==n.css("display")&&(r=0,d="100%")):(r=0,a=0,d="auto",c="auto");var h=t(e.container);h.css({width:d,height:c,left:r,top:a}),e.setAutoScrollEditorIntoView(!i),e.resize()},readOnly:!0}]),this.editor.commands.addCommands([{name:"newLine",bindKey:{win:"Ctrl+Enter",mac:"Command+Enter"},exec:function(t){t.navigateLineEnd(),t.getSession().getDocument().insertNewLine(t.getCursorPosition())},readOnly:!0}]),this.editor.commands.addCommands([{name:"Visual Tab",bindKey:{win:"Ctrl+R",mac:"Command+R"},exec:function(){var e=t("#content-tmce");e&&e.click()},readOnly:!0}]),this.editor.getSession().setMode("ace/mode/html"),this.editor.setTheme(n);var r=!0;e&&(r=e.wrapMode),this.editor.getSession().setUseWrapMode(r),this.editor.getSession().setTabSize(2),this.editor.setShowPrintMargin(!1),this.editor.setOptions({fontSize:i,enableEmmet:!0,behavioursEnabled:!1,displayIndentGuides:!0})},setEditorContent:function(){tinyMCE.get(this.element).save();var e=t("#content").text(),i=t("#content_ifr")[0];i&&(e=i.contentDocument.body.innerHTML);var n={indent_inner_html:!1,indent_size:2,wrap_line_length:0,end_with_newline:!0};e=html_beautify(e,n),e=this.customFormatHTML(e),this.editor.getSession().setValue(e)},setEditorStyle:function(){var t=this;this.$container.css({position:"relative","min-height":"100px",height:this.height}),this.editor.renderer.setScrollMargin(5,5,0,0),this.$container.resizable({handles:"s",resize:function(){t.editor.resize()}})},synchronize:function(){var e=this.editor.getValue();t("#content").text(e);var i=tinyMCE.get(this.element);this.tinymce&&i&&i.setContent(e)},destroy:function(){return this.loaded?(this.$editor.remove(),this.editor.destroy(),this.loaded=!1,void(this.onDestroy&&this.onDestroy.apply(this,arguments))):!1},customFormatHTML:function(t){var e=["p","pre","div","h3"],i=t;for(var n in e){var o=e[n],s=new RegExp("(<"+o+")","g");i=i.replace(s,"\n$1")}return i}},t.fn.AceEditor=function(i,n){var i=i||null,o=t(this).data("AceEditor");if(o&&"string"==typeof i&&o[i])o[i](n||null);else{if(!o){var s=t.extend({element:t(this),aceId:"ace-editor",container:!1},i);return t(this).data("AceEditor",new e(s)),t(this)}t.error('Method "'+i+'" does not exist on AceEditor!')}}}(jQuery);